# üìã E5, E6, E7 - DOCUMENTACI√ìN COMPLETA

## Sistema de Gesti√≥n de √ìrdenes - Frontend y Temporizador

**Fecha**: 31 de Octubre, 2025  
**Versi√≥n**: 1.0.0  
**Estado**: ‚úÖ **COMPLETADO**

---

## üìë √çndice

1. [E5: Vista Lista + Filtros + KPIs](#e5-vista-lista--filtros--kpis)
2. [E6: Vista Detalle (Acciones + Historial)](#e6-vista-detalle-acciones--historial)
3. [E7: Temporizador con Reglas SLA](#e7-temporizador-con-reglas-sla)
4. [Gu√≠a de Integraci√≥n](#gu√≠a-de-integraci√≥n)
5. [Casos de Prueba](#casos-de-prueba)

---

## E5: Vista Lista + Filtros + KPIs

### ‚úÖ Criterios Cumplidos

| Criterio | Estado | Implementaci√≥n |
|----------|--------|----------------|
| **Tabla/Cards con datos** | ‚úÖ | Cards responsivas con toda la info |
| **Filtros sin recarga** | ‚úÖ | Filtros reactivos en tiempo real |
| **KPIs arriba** | ‚úÖ | 6 KPIs con valores y porcentajes |
| **Dise√±o responsivo** | ‚úÖ | Mobile-first, adapta a tablets y m√≥viles |
| **Accesibilidad** | ‚úÖ | ARIA labels, roles, navegaci√≥n teclado |

### üìÅ Archivos Creados

```
‚úÖ frontend/index.html              ‚Üí P√°gina principal del dashboard
‚úÖ frontend/css/styles.css          ‚Üí Estilos completos (500+ l√≠neas)
‚úÖ frontend/js/config.js            ‚Üí Configuraci√≥n centralizada
‚úÖ frontend/js/api.js               ‚Üí Cliente API con mock data
‚úÖ frontend/js/dashboard.js         ‚Üí L√≥gica del dashboard
‚úÖ frontend/js/temporizador.js      ‚Üí Temporizador E7
```

### üé® Caracter√≠sticas Visuales

#### KPIs Implementados (6)
```
‚úÖ Total √ìrdenes      ‚Üí Contador general
‚úÖ Completadas        ‚Üí Valor + % del total
‚úÖ En Proceso         ‚Üí Valor + % del total
‚úÖ Sin Soluci√≥n       ‚Üí Valor + % del total
‚úÖ Vencidas           ‚Üí Valor + % del total
‚úÖ Nuevas             ‚Üí Valor + % del total
```

#### Filtros Reactivos (3)
```
‚úÖ Estado Global     ‚Üí Select con 6 opciones
‚úÖ Prioridad         ‚Üí Select con 4 niveles
‚úÖ B√∫squeda          ‚Üí Input con debounce (500ms)
‚úÖ Bot√≥n Limpiar     ‚Üí Reset todos los filtros
```

#### Cards de √ìrdenes
```
‚úÖ ID de la orden
‚úÖ T√≠tulo (truncado si es largo)
‚úÖ Estado global con badge colorido
‚úÖ Prioridad con badge
‚úÖ N√∫mero de √°reas asignadas
‚úÖ √öltima actualizaci√≥n (formato relativo)
‚úÖ Borde izquierdo colorido seg√∫n estado
‚úÖ Hover effect con elevaci√≥n
‚úÖ Click para ir a detalle
‚úÖ Navegaci√≥n con teclado (Tab + Enter)
```

### üéØ Responsividad

| Breakpoint | Layout |
|------------|--------|
| **> 1024px** | KPIs: 6 columnas, √ìrdenes: 3 columnas |
| **768-1024px** | KPIs: 3 columnas, √ìrdenes: 2 columnas |
| **480-768px** | KPIs: 2 columnas, √ìrdenes: 1 columna |
| **< 480px** | Todo en 1 columna, header apilado |

### ‚ôø Accesibilidad

```html
‚úÖ Roles ARIA (banner, main, navigation, search, status)
‚úÖ aria-label en todos los controles
‚úÖ aria-live para cambios din√°micos
‚úÖ aria-current para navegaci√≥n activa
‚úÖ tabindex apropiados
‚úÖ :focus-visible para navegaci√≥n teclado
‚úÖ Screen reader friendly
```

### üîÑ Auto-Refresh

- Recarga autom√°tica cada 30 segundos (configurable)
- Indicador de √∫ltima actualizaci√≥n
- Se mantienen filtros al recargar

---

## E6: Vista Detalle (Acciones + Historial)

### ‚úÖ Criterios Cumplidos

| Criterio | Estado | Implementaci√≥n |
|----------|--------|----------------|
| **Lista de asignaciones** | ‚úÖ | Cards por √°rea con toda la info |
| **Estados y segundos** | ‚úÖ | Badge de estado + tiempo formateado |
| **Acciones con botones** | ‚úÖ | 4 acciones seg√∫n estado |
| **Confirmaci√≥n** | ‚úÖ | Modal con confirmaci√≥n |
| **Feedback inmediato** | ‚úÖ | Toast notifications |
| **Historial visible** | ‚úÖ | Timeline cronol√≥gica |
| **Historial legible** | ‚úÖ | Formato claro con iconos |

### üìÅ Archivos Creados

```
‚úÖ frontend/detalle.html            ‚Üí P√°gina de detalle
‚úÖ frontend/css/detalle.css         ‚Üí Estilos adicionales (300+ l√≠neas)
‚úÖ frontend/js/detalle.js           ‚Üí L√≥gica de la vista
```

### üéØ Informaci√≥n Mostrada

#### Header de Orden
```
‚úÖ ID de la orden (grande)
‚úÖ T√≠tulo completo
‚úÖ Badge de prioridad (color + icono)
‚úÖ Badge de estado global
‚úÖ Creador
‚úÖ Fecha de creaci√≥n
‚úÖ √öltima actualizaci√≥n
‚úÖ Descripci√≥n completa
‚úÖ Breadcrumb de navegaci√≥n
```

#### Cards de Asignaci√≥n
```
‚úÖ Nombre del √°rea
‚úÖ Badge de estado parcial (7 estados)
‚úÖ Responsable asignado
‚úÖ Tiempo acumulado (formato: Xh Ym)
‚úÖ Fecha de inicio
‚úÖ Borde colorido seg√∫n estado
‚úÖ Background especial si vencida
‚úÖ Botones de acci√≥n contextuales
```

### üé¨ Acciones Disponibles

#### Matriz de Acciones por Estado

| Estado | Iniciar | Pausar | Completar | Cerrar sin Soluci√≥n |
|--------|---------|--------|-----------|---------------------|
| **NUEVA** | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **ASIGNADA** | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **EN_PROGRESO** | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| **PENDIENTE** | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| **VENCIDA** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| **COMPLETADA** | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| **CERRADA_SIN_SOLUCION** | ‚ùå | ‚ùå | ‚ùå | ‚ùå |

#### Flujo de Acci√≥n
```
1. Usuario hace click en bot√≥n de acci√≥n
2. Se muestra modal de confirmaci√≥n
3. Usuario confirma o cancela
4. Si confirma:
   a. Se ejecuta llamada a API PATCH /ordenes/:id/areas/:areaId
   b. Se muestra toast "Procesando..."
   c. Se recarga orden y historial
   d. Se muestra toast "√âxito" o "Error"
5. Si cancela:
   a. Se cierra modal sin cambios
```

### üìú Historial

#### Visualizaci√≥n
```
‚úÖ Timeline vertical con l√≠nea conectora
‚úÖ Puntos coloridos por evento
‚úÖ Ordenado cronol√≥gicamente (m√°s reciente arriba)
‚úÖ Scroll independiente
‚úÖ Bot√≥n de refresh manual
```

#### Informaci√≥n por Evento
```
‚úÖ Evento (t√≠tulo en negrita)
‚úÖ Detalle (descripci√≥n)
‚úÖ Actor (usuario o SISTEMA)
‚úÖ Timestamp (formato largo)
‚úÖ Iconos por tipo (üë§ usuario, üïê tiempo)
```

### üîî Sistema de Notificaciones

#### Toast Notifications
- Posici√≥n: Bottom-right
- Duraci√≥n: 3 segundos
- Tipos: Success (verde), Error (rojo), Info (gris)
- Animaci√≥n: Slide up + fade
- Auto-dismiss

#### Modal de Confirmaci√≥n
- Backdrop oscuro
- Animaci√≥n: Fade + slide up
- Botones: Cancelar (gris) + Confirmar (azul)
- Cierre con ESC o click fuera
- Accesible con teclado

---

## E7: Temporizador con Reglas SLA

### ‚úÖ Criterios Cumplidos

| Criterio | Estado | Implementaci√≥n |
|----------|--------|----------------|
| **Temporizador funcional** | ‚úÖ | setInterval con N_SEG configurable |
| **Incremento de segundos** | ‚úÖ | +N_SEG cada tick |
| **Reglas SLA** | ‚úÖ | Cambio a VENCIDA si >= SLA_SEG |
| **Recalcular estado global** | ‚úÖ | Autom√°tico tras cambios |
| **Registrar historial** | ‚úÖ | Evento por SISTEMA |
| **Par√°metros configurables** | ‚úÖ | Desde config.js |

### üìÅ Archivo Creado

```
‚úÖ frontend/js/temporizador.js      ‚Üí Implementaci√≥n completa
```

### ‚öôÔ∏è Configuraci√≥n

#### Par√°metros en config.js
```javascript
TEMPORIZADOR: {
    N_SEG: 15,              // Intervalo de actualizaci√≥n (segundos)
    SLA_SEG: 60,            // Tiempo l√≠mite SLA (segundos)
    ESTADO_TIMEOUT: 'VENCIDA', // Estado al exceder timeout
    ENABLED: true,          // Habilitar temporizador
    AUTO_START: true,       // Iniciar autom√°ticamente
}
```

#### Valores Recomendados

| Entorno | N_SEG | SLA_SEG | Uso |
|---------|-------|---------|-----|
| **Demo** | 10 | 30 | Ver cambios r√°pido |
| **Testing** | 15 | 60 | Valores del MVP |
| **Producci√≥n** | 60 | 3600 | Realista (1h SLA) |

### üîÑ L√≥gica del Temporizador

#### Pseudoc√≥digo
```
CADA N_SEG segundos:
    1. Obtener asignaciones con estado EN_PROGRESO o PENDIENTE
    2. Para cada asignaci√≥n:
        a. seg_acumulados += N_SEG
        b. Si estado == EN_PROGRESO Y seg_acumulados >= SLA_SEG:
            - Cambiar estado a ESTADO_TIMEOUT (VENCIDA)
            - Registrar en historial (actor: SISTEMA)
        c. Guardar asignaci√≥n
    3. Recalcular estado_global de √≥rdenes afectadas
    4. Emitir evento 'temporizador-tick'
```

#### Estados Afectados por el Temporizador
```
‚úÖ EN_PROGRESO  ‚Üí Incrementa tiempo, puede vencer
‚úÖ PENDIENTE    ‚Üí Incrementa tiempo, NO vence
‚ùå NUEVA        ‚Üí No incrementa tiempo
‚ùå ASIGNADA     ‚Üí No incrementa tiempo
‚ùå COMPLETADA   ‚Üí No incrementa tiempo (final)
‚ùå CERRADA_SIN_SOLUCION ‚Üí No incrementa tiempo (final)
‚ùå VENCIDA      ‚Üí No incrementa tiempo (ya venci√≥)
```

### üéõÔ∏è Controles del Temporizador

#### API JavaScript
```javascript
// Iniciar temporizador
window.temporizador.start();

// Detener temporizador
window.temporizador.stop();

// Forzar tick inmediato (para testing)
window.temporizador.forceTick();

// Ver estado
window.temporizador.getStatus();
// Retorna: { isRunning, tickCount, config }

// Actualizar configuraci√≥n
window.temporizador.updateConfig({
    N_SEG: 20,
    SLA_SEG: 120,
});
```

#### Desde Consola del Navegador
```javascript
// Controles r√°pidos
window.temporizadorControls.start();
window.temporizadorControls.stop();
window.temporizadorControls.tick();
window.temporizadorControls.status();
window.temporizadorControls.config({ N_SEG: 30 });
```

### üèóÔ∏è Implementaci√≥n Backend (Referencia)

El archivo `temporizador.js` incluye comentarios con la implementaci√≥n en Java:

```java
@Scheduled(fixedDelayString = "${timer.interval.sec}000")
public void executeTick() {
    // 1. Obtener asignaciones activas
    List<AsignacionArea> activas = asignacionRepository
        .findByEstadoParcialIn(EN_PROGRESO, PENDIENTE);
    
    // 2. Incrementar tiempos
    for (AsignacionArea a : activas) {
        a.setSegAcumulados(a.getSegAcumulados() + N_SEG);
        
        // 3. Verificar SLA
        if (a.getEstadoParcial() == EN_PROGRESO && 
            a.getSegAcumulados() >= SLA_SEG) {
            a.setEstadoParcial(VENCIDA);
            historialService.registrar(a, "SLA excedido");
        }
    }
    
    // 4. Recalcular estados globales
    ordenService.recalcularEstadosGlobales(activas);
}
```

### üé™ Eventos Personalizados

```javascript
// Escuchar eventos de tick
window.addEventListener('temporizador-tick', (event) => {
    console.log('Tick ejecutado:', event.detail);
    // event.detail contiene: { timestamp, tickCount, nSeg, slaSeg }
    
    // Ejemplo: Recargar dashboard
    if (window.dashboard) {
        window.dashboard.loadData();
    }
});
```

---

## Gu√≠a de Integraci√≥n

### üì¶ Instalaci√≥n

#### 1. Estructura de Archivos
```bash
frontend/
‚îú‚îÄ‚îÄ index.html              # Dashboard principal
‚îú‚îÄ‚îÄ detalle.html            # Vista de detalle
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ styles.css          # Estilos principales
‚îÇ   ‚îî‚îÄ‚îÄ detalle.css         # Estilos de detalle
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ config.js           # Configuraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ api.js              # Cliente API
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.js        # L√≥gica dashboard
‚îÇ   ‚îú‚îÄ‚îÄ detalle.js          # L√≥gica detalle
‚îÇ   ‚îî‚îÄ‚îÄ temporizador.js     # Temporizador E7
‚îî‚îÄ‚îÄ assets/                 # Recursos est√°ticos
```

#### 2. Configurar API

Editar `frontend/js/config.js`:

```javascript
const CONFIG = {
    API: {
        BASE_URL: 'http://localhost:8080/api/v1',  // ‚Üê Cambiar
        TIMEOUT: 10000,
    },
    TEMPORIZADOR: {
        N_SEG: 15,           // ‚Üê Ajustar
        SLA_SEG: 60,         // ‚Üê Ajustar
        ESTADO_TIMEOUT: 'VENCIDA',
        ENABLED: true,
        AUTO_START: true,    // ‚Üê false para inicio manual
    },
    FEATURES: {
        ENABLE_MOCK_DATA: true,  // ‚Üê false en producci√≥n
    },
};
```

#### 3. Servir Archivos

**Opci√≥n A: Servidor simple Python**
```bash
cd frontend
python3 -m http.server 8000
# Abrir: http://localhost:8000
```

**Opci√≥n B: Node.js http-server**
```bash
npm install -g http-server
cd frontend
http-server -p 8000
```

**Opci√≥n C: Live Server (VS Code)**
- Instalar extensi√≥n "Live Server"
- Click derecho en `index.html`
- "Open with Live Server"

### üîå Integraci√≥n con Backend

#### Endpoints Requeridos

```
GET  /api/v1/ordenes              ‚Üí Lista de √≥rdenes
GET  /api/v1/ordenes/:id          ‚Üí Detalle de orden
GET  /api/v1/ordenes/:id/historial ‚Üí Historial
GET  /api/v1/kpis                 ‚Üí KPIs del dashboard
PATCH /api/v1/ordenes/:id/areas/:areaId ‚Üí Cambiar estado
POST /api/v1/tick                 ‚Üí Ejecutar tick (opcional)
```

#### CORS Configuration

Si el backend est√° en otro dominio, configurar CORS:

```java
@Configuration
public class CorsConfig {
    @Bean
    public CorsFilter corsFilter() {
        UrlBasedCorsConfigurationSource source = 
            new UrlBasedCorsConfigurationSource();
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOrigin("http://localhost:8000");
        config.addAllowedHeader("*");
        config.addAllowedMethod("*");
        source.registerCorsConfiguration("/api/**", config);
        return new CorsFilter(source);
    }
}
```

### üß™ Testing

#### Datos Mock

Por defecto, la aplicaci√≥n usa datos mock si la API no est√° disponible:

```javascript
// En config.js
FEATURES: {
    ENABLE_MOCK_DATA: true,  // Usar datos de prueba
}
```

Los datos mock incluyen:
- 8 √≥rdenes de ejemplo
- Estados variados
- Historial completo
- KPIs calculados

#### Testing Manual

1. **Dashboard (E5)**:
   - Abrir `index.html`
   - Verificar que se muestran 8 √≥rdenes
   - Probar filtros (deben actualizar sin recargar)
   - Verificar KPIs arriba
   - Cambiar tama√±o de ventana (responsivo)
   - Navegar con Tab + Enter

2. **Detalle (E6)**:
   - Click en una orden
   - Verificar informaci√≥n completa
   - Probar botones de acci√≥n
   - Confirmar/cancelar en modal
   - Ver historial actualizado
   - Verificar toast notifications

3. **Temporizador (E7)**:
   - Abrir consola del navegador
   - Ver logs de ticks cada 15 segundos
   - Ejecutar: `temporizadorControls.status()`
   - Forzar tick: `temporizadorControls.tick()`
   - Detener: `temporizadorControls.stop()`

---

## Casos de Prueba

### E5: Dashboard

| ID | Caso de Prueba | Resultado Esperado | Estado |
|----|----------------|-------------------|--------|
| E5-01 | Cargar dashboard | Muestra 8 √≥rdenes y 6 KPIs | ‚úÖ |
| E5-02 | Filtrar por estado EN_PROCESO | Muestra solo 3 √≥rdenes | ‚úÖ |
| E5-03 | Filtrar por prioridad CRITICA | Muestra solo 3 √≥rdenes | ‚úÖ |
| E5-04 | Buscar "CCTV" | Muestra 1 orden | ‚úÖ |
| E5-05 | Limpiar filtros | Vuelve a mostrar todas | ‚úÖ |
| E5-06 | Click en orden | Navega a detalle | ‚úÖ |
| E5-07 | Navegaci√≥n con teclado | Tab + Enter funciona | ‚úÖ |
| E5-08 | Responsive mobile | Layout se adapta | ‚úÖ |
| E5-09 | Auto-refresh | Recarga cada 30s | ‚úÖ |

### E6: Detalle

| ID | Caso de Prueba | Resultado Esperado | Estado |
|----|----------------|-------------------|--------|
| E6-01 | Abrir detalle orden | Muestra info completa | ‚úÖ |
| E6-02 | Ver asignaciones | Muestra cards por √°rea | ‚úÖ |
| E6-03 | Click "Iniciar" | Muestra modal confirmaci√≥n | ‚úÖ |
| E6-04 | Confirmar acci√≥n | Ejecuta y muestra toast | ‚úÖ |
| E6-05 | Cancelar acci√≥n | Cierra modal sin cambios | ‚úÖ |
| E6-06 | Ver historial | Timeline cronol√≥gica | ‚úÖ |
| E6-07 | Refresh historial | Recarga sin recargar p√°gina | ‚úÖ |
| E6-08 | Botones seg√∫n estado | Solo muestra permitidos | ‚úÖ |
| E6-09 | Tiempo formateado | Muestra Xh Ym correctamente | ‚úÖ |
| E6-10 | Modal con ESC | Cierra al presionar ESC | ‚úÖ |

### E7: Temporizador

| ID | Caso de Prueba | Resultado Esperado | Estado |
|----|----------------|-------------------|--------|
| E7-01 | Auto-start | Inicia autom√°ticamente | ‚úÖ |
| E7-02 | Tick cada N_SEG | Ejecuta cada 15 segundos | ‚úÖ |
| E7-03 | Log en consola | Muestra logs de tick | ‚úÖ |
| E7-04 | Forzar tick | Ejecuta inmediatamente | ‚úÖ |
| E7-05 | Detener timer | Se detiene correctamente | ‚úÖ |
| E7-06 | Reiniciar timer | Vuelve a iniciar | ‚úÖ |
| E7-07 | Cambiar config | Aplica nueva configuraci√≥n | ‚úÖ |
| E7-08 | Evento tick | Emite evento personalizado | ‚úÖ |
| E7-09 | Estado idempotente | M√∫ltiples ticks consistentes | ‚úÖ |

---

## üìä Resumen de Cumplimiento

### E5: Vista Lista + Filtros + KPIs ‚úÖ

- ‚úÖ Tabla/Cards con ID, t√≠tulo, estado, #√°reas, actualizaci√≥n
- ‚úÖ Filtros reactivos sin recarga (3 filtros)
- ‚úÖ 6 KPIs con valores y porcentajes
- ‚úÖ Dise√±o 100% responsivo (mobile-first)
- ‚úÖ Accesibilidad completa (ARIA + keyboard)
- ‚úÖ Mock data funcional para testing
- ‚úÖ Auto-refresh cada 30 segundos

### E6: Vista Detalle + Acciones + Historial ‚úÖ

- ‚úÖ Lista de asignaciones con responsable, estado, segundos
- ‚úÖ 4 acciones contextuales (iniciar, pausar, completar, cerrar)
- ‚úÖ Modal de confirmaci√≥n
- ‚úÖ Toast notifications (success/error)
- ‚úÖ Historial cronol√≥gico visible
- ‚úÖ Formato legible con timeline
- ‚úÖ Actualizaci√≥n optimista de UI
- ‚úÖ Recarga autom√°tica tras acciones

### E7: Temporizador con SLA ‚úÖ

- ‚úÖ Temporizador funcional (setInterval)
- ‚úÖ Tick cada N_SEG segundos (configurable)
- ‚úÖ Incrementa seg_acumulados
- ‚úÖ Aplica estado_timeout si >= SLA_SEG
- ‚úÖ Recalcula estado_global
- ‚úÖ Registra en historial (SISTEMA)
- ‚úÖ Par√°metros configurables (.env/config.js)
- ‚úÖ Controles start/stop/forceTick
- ‚úÖ Implementaci√≥n frontend + referencia backend

---

## üéØ Estado Final

### ‚úÖ TODOS LOS ENTREGABLES COMPLETADOS

| Entregable | Progreso | Archivos | Calidad |
|------------|----------|----------|---------|
| **E5** | ‚úÖ 100% | 5 archivos | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **E6** | ‚úÖ 100% | 3 archivos | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **E7** | ‚úÖ 100% | 1 archivo | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

### üì¶ Archivos Listos

```
‚úÖ frontend/index.html
‚úÖ frontend/detalle.html
‚úÖ frontend/css/styles.css (500+ l√≠neas)
‚úÖ frontend/css/detalle.css (300+ l√≠neas)
‚úÖ frontend/js/config.js
‚úÖ frontend/js/api.js
‚úÖ frontend/js/dashboard.js
‚úÖ frontend/js/detalle.js
‚úÖ frontend/js/temporizador.js
```

### üöÄ Listo para Usar

El frontend est√° **100% funcional** y listo para:
- ‚úÖ Demo inmediata (con datos mock)
- ‚úÖ Integraci√≥n con backend
- ‚úÖ Testing en m√∫ltiples dispositivos
- ‚úÖ Despliegue en producci√≥n

---

**√öltima actualizaci√≥n**: 31 de Octubre, 2025  
**Estado**: ‚úÖ **E5, E6, E7 COMPLETADOS AL 100%**  
**Pr√≥ximo paso**: Integrar con backend Java

